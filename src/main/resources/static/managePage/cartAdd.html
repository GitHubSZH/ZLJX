<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title></title>
    <style type="text/css">
        .gcs-radio {

            display: none;

        }
        #close{
            float: right;
        }
        .gcs-radio+label {

            width: 20px;

            height: 20px;

            line-height: 20px;

            display: inline-block;

            text-align: center;

            vertical-align: bottom;

            border: 1px solid gray;

            border-radius: 50%;

        }

        .gcs-radio+label:hover {

            border: 1px solid #2783FB;

            cursor: pointer;

        }

        .gcs-radio:checked+label {

            background: #2783FB;

            border: 1px solid #2783FB;

        }

        .gcs-radio:checked+label:after {

            content: "\2022";

            font-size: 35px;

            color: white;

        }
      /* #add_form{
           margin: 10px;
        }*/
        .layui-form-item{
            margin: 10px;
        }
    </style>
<body class="layui-layout-body">
<form class="layui-form" method="post" id="add_form">
    <div class="layui-form-item">
        <label class="layui-form-label">吊车名称</label>
        <div class="layui-input-block">
            <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入吊车名称" class="layui-input p_name">
        </div>
    </div>


    <div class="layui-form-item">
        <label class="layui-form-label">吊车大小</label>
        <div class="layui-input-block">
            <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入吊车大小单位为吨" class="layui-input p_price">
        </div>
    </div>


    <div class="layui-form-item">
        <label class="layui-form-label p_type">吊车类型</label>
        <div style="padding-top: 5px">

            <input type="radio" name="sex" class="gcs-radio" value="吊车" id="吊车" />吊车
            <label for="吊车"></label>
            &nbsp;&nbsp;&nbsp;
            <input type="radio" name="sex" class="gcs-radio" value="随车吊" id="随车吊" />随车吊
            <label for="随车吊"></label>

        </div>
    </div>


    <!--<label class="layui-form-label">图片路径</label>
    <div class="layui-upload">
        <div class="layui-input-block">
            <input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入商品价格" class="layui-input p_url">
        </div>
    </div>-->
    <div class="layui-form-item">
                <label class="layui-form-label">吊车图片上传</label>
                <div class="layui-input-block">
                    <button type="button" class="layui-btn" id="test1">
                        <i class="layui-icon">&#xe67c;</i>选择图片（最多选择20张，单张图片最大为10M）
                    </button>
                    <button type="button" class="layui-btn" id="test9">开始上传</button>
                    <button type="button" class="layui-btn" id="cleanImgs"> <i class="fa fa-trash-o fa-lg"></i>清空图片预览</button>
                <!--<form id="f1" method="post" enctype="multipart/form-data">
                    <input type="file" name="files" multiple="multiple">
                    <input type="button" id="submit" value="上传" name="上传"></input>
                </form>-->
                    <input type="hidden" id="hiddenIput">
                </div>
                <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;">
                    预览图：
                    <div class="layui-upload-list" id="demo2"></div>
                </blockquote>
            </div>


    <div class="layui-form-item layui-form-text">
        <label class="layui-form-label">吊车描述</label>
        <div class="layui-input-block">
            <textarea placeholder="请输入内容" class="layui-textarea p_description"></textarea>
        </div>
    </div>

    <div ></div><button type="button" class="layui-btn layui-btn-primary layui-btn-lg" id="p_add">确认</button>
    <button type="button" class="layui-btn layui-btn-primary layui-btn-lg" id="close">取消</button>
</form>
</body>
</html>

<script type="text/javascript">
    $(function(){
       /* var formData = new FormData($("#f1")[0]);
        console.log(formData);
        $("#submit").on("click",function () {
            $.ajax({
                url:"/upload",//后台的接口地址
                type:"post",//post请求方式
                data:formData,//参数
                cache: false,
                processData: false,
                contentType: false,
                success:function (data) {
                    alert(data);
                },error:function () {
                    alert("操作失败~");
                }
            })
        })*/

        $("#p_add").click(function(){
            /*var prod_name = $(".p_name").val();
            var price = $(".p_price").val();
            var url = $(".p_url").val();
            var description = $(".p_description").val();
            var type = $("input[name='sex']:checked").val()
            var pizza_type = $("input[name='1']:checked").val()
            var  size =$("input[name='six']:checked").val()
            console.log(prod_name,price,url,description,type,pizza_type,size);
            if(typeof(size) != "undefined"){
                parseInt(size);
            }*/
            //var url = "product/doUpdatePruduceUI.do";
            /*var params = {"prod_name":prod_name,
                    "price":price,"url":url,"description":description,
                    "type":type,"pizza_type":pizza_type,"size":size};
            $.ajax({
                url : "product/doAddPruduceUI.do",
                data : params,
                async : false,
                success : function(result) {
                    if (result.state == 1) {
                            alert(result.message);
                            sessionStorage.clear();
                            $(".layui-body").load("doProductMemu.do");
                        } else {
                            alert(result.message);
                        }
                    }
            });*/

            var params={
                prod_name : $(".p_name").val()
                ,price : $(".p_price").val()
                , url :$(".p_url").val()
                ,description: $(".p_description").val()
                , type :$("input[name='sex']:checked").val()
                ,pizza_type :$("input[name='1']:checked").val()
                ,size :$("input[name='six']:checked").val()
            }
            console.log(params.price);
            if(!(jQuery.isNumeric(params.price))||params.price==""){
                alert("商品价格参数填写错误");
                return false;
            }
            $.post("product/doAddPruduceUI.do",params,function(result){
                if (result.state == 1) {
                    alert(result.message);
                    $(".layui-body").load("doProductMemu.do");
                } else {
                    alert(result.message);
                }
            });
        });


        $("#close").click(function(){
            $(".layui-body").load("doProductMemu.do");
            sessionStorage.clear();
        })
    })

    var success=0;
    var fail=0;
    var imgurls="";

    $(function (){
        var imgsName="";
        layui.use(['upload','layer'],function() {
            var upload = layui.upload;
            var layer=layui.layer;

            upload.render({
                elem: '#test1',
                url: '/upload',
                multiple: true,
                auto:false,
//			上传的单个图片大小
                size:10240,
//			最多上传的数量
                number:20,
			//MultipartFile:file, //对应，layui默认就是file,要改动则相应改动
                field:'files',
                bindAction: '#test9',
                before: function(obj) {
                    //预读本地文件示例，不支持ie8
                    obj.preview(function(index, file, result) {
                        $('#demo2').append('<img src="' + result
                            + '" alt="' + file.name
                            +'"height="92px" width="92px" class="layui-upload-img uploadImgPreView">')
                    });
                },
                done: function(res, index, upload) {
                    //每个图片上传结束的回调，成功的话，就把新图片的名字保存起来，作为数据提交
                    console.log(res.data);
                    $("#hiddenIput").append(res.data);
                    if(res.code=="1"){
                        fail++;
                    }else{
                        success++;
                        imgurls=imgurls+""+res.data.src+",";
                        $('#imgUrls').val(imgurls);
                    }
                },
                allDone:function(obj){
                    layer.msg("总共要上传图片总数为："+(fail+success)+"\n"
                        +"其中上传成功图片数为："+success+"\n"
                        +"其中上传失败图片数为："+fail
                    )
                }
            });

        });

        //清空预览图片
        cleanImgsPreview();
        //保存商品
        goodsSave();
    });

    /**
     * 清空预览的图片及其对应的成功失败数
     * 原因：如果已经存在预览的图片的话，再次点击上选择图片时，预览图片会不断累加
     * 表面上做上传成功的个数清0，实际后台已经上传成功保存了的，只是没有使用，以最终商品添加的提交的为准
      */
    function cleanImgsPreview(){
        $("#cleanImgs").click(function(){
            success=0;
            fail=0;
            $('#demo2').html("");
            $('#imgUrls').val("");
        });
    }

    /**
     * 保存商品
     */
    function goodsSave(){
        $('#btnSubmit').click(function(){
            var tt=$("#title").val();
            var st=$("#smallTit").val();
            var ius=$("#imgUrls").val();

            $.ajax({
                type: "POST",
                url: "/saveGoods",
                data: {
                    title:tt,
                    smallTit:st,
                    imgUrls:ius,
                },
                success: function(msg){
                    if(msg=="1"){
                        alert("保存成功");
                    }else{
                        alert("保存失败");
                    }
                }
            });
        });
    }

</script>
</html>